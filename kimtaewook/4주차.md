# 스파크에서 다루는 특징적인 파일 종류
## .parquet(파케이)
- Spark의 대표적인 파일 포멧
- 컬럼 지향형 데이터 저장 방식으로 파일을 읽어서 분석하는 데 최적화
- 데이터 전체를 읽는 대신 개별 컬럼을 읽을 수 있음
- 자체 스키마를 내장하고있기 때문에 별도의 스키마를 지정할 필요 없음
- 읽기에는 좋은 반면에 쓰기 작업량이 많은 경우 컬럼 지향형 즉, 열 단위로 압축 및 인코딩을 수행하기 때문에 비용이 많이 들 수 있다
```python
# 데이터 읽기
spark.read.format("parquet")\
    .load("/warehouse/if_date/202509/202509-summary.parquet").show(5)
```
### 개별 컬럼을 읽는다?
```
+---+-----+----+-----+
| ID| 이름 |부서| 연봉 |
+---+-----+----+-----+
|  1|Alice|  HR|70000|
|  2|  Bob| Eng|90000|
|  3|Carol|  HR|75000|
+---+-----+----+-----+

```
#### 위와 같은 데이터프레임에서 전체 직원의 연봉의 평균을 구하려는 경우
- .csv 의 경우 1번째 행의 ID, 이름, 부서, 연봉 값을 모두 읽고 거기서 다시 연봉값인 70000 을 제외한 나머지를 버린다 이와 같은 작업을 모든 행(row) 에 반복한다
- .parquet 의 경우 처음부터 '연봉' 컬럼의 값들만 정확히 읽는다(개별 컬럼을 읽는다) 즉, 불필요한 I/O 작업이 발생하지 않기 때문에 성능이 좋다 

### 참조
- https://wook-lab.tistory.com/20
- https://pinggoopark.tistory.com/entry/Spark-Apache-Parquet-%ED%8C%8C%EC%9D%BC-%EA%B5%AC%EC%A1%B0

## .orc
- Hive 생태계에서 대규모 데이터를 저장하는 데 사용되는 파일 형식(Hive 에 최적화)
- .parquet 와 같이 컬럼 기반으로 저장
- 압축률이 높아서 스토리지 비용을 절감에 좋다.
- ACID 트랜잭션을 지원한다   
--> 일반적인 hdfs 의 경우 한 번 저장된 파일은 수정할 수 없음 하지만 .orc 의 경우 Update, Delete 가능
- 인덱스를 이용한 데이터 스키핑

### 인덱스를 이용한 데이터 스키핑?
- 내부 데이터를 여러 계층으로 나누어 저장하고 이 계층 별로 컬럼별 상세 통계정보를 기록함
- wherw person_id = 1341 과 같은 쿼리 조건을 사용한다고 했을 때 각 계층 별로 {min: 1, max: 1000}, {min 1001, max: 2000} 와 같다면 첫 번째 계층은 읽지 않고 건너 뛴다.

### 참조

- https://medium.com/@diehardankush/why-parquet-vs-orc-an-in-depth-comparison-of-file-formats-5fc3b5fdac2e
- https://pinggoopark.tistory.com/entry/Spark-Apache-ORC-%ED%8C%8C%EC%9D%BC-%EA%B5%AC%EC%A1%B0

## .avro
- 데이터와 스키마를 포함해서 인코딩(또는 직렬화)한 포맷
- 컴퓨터가 읽기 좋은 바이너리 파일이기 때문에 사람이 읽기 위해 디코딩이 필요함
- 파일에 스키마가 포함되어있기 때문에 별도의 스키마 지정이 필요 없음

``` python
# .avro 읽어옴
read_df = spark.read.format("avro").load(/path/test.avro)

# 데이터프레임 스키마 출력
read_df.printSchema()
```

- .avro 파일에 스키마를 포함하고 있기 때문에 시스템 혹은 사람들 사이에 데이터를 주고 받을 때 유용함

## .avsc
- 스키마(타입, 크기 등)만을 정의하는 텍스트 파일(json) 즉, 스키마만 포함하고 있음
- 바이너리 파일이 아니기 때문에 사람이 직접 파일을 열어서 읽고 수정할 수 있음

### 참조
- https://junior-datalist.tistory.com/384
- https://louisdev.tistory.com/63
